# 博客系统数据库表结构设计

## 1. 用户表 (users)

存储用户基本信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 用户ID，主键 |
| username | VARCHAR | 50 | NO | - | 用户名，唯一 |
| email | VARCHAR | 100 | NO | - | 邮箱，唯一 |
| password | VARCHAR | 255 | NO | - | 密码（加密存储） |
| nickname | VARCHAR | 50 | YES | NULL | 昵称 |
| avatar | VARCHAR | 500 | YES | NULL | 头像URL |
| bio | TEXT | - | YES | NULL | 个人简介 |
| website | VARCHAR | 200 | YES | NULL | 个人网站 |
| github | VARCHAR | 200 | YES | NULL | GitHub地址 |
| role | TINYINT | - | NO | 0 | 角色：0-普通用户，1-管理员 |
| status | TINYINT | - | NO | 1 | 状态：0-禁用，1-启用 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_username (username)
- UNIQUE KEY uk_email (email)
- KEY idx_status (status)

---

## 2. 分类表 (categories)

存储文章分类信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 分类ID，主键 |
| name | VARCHAR | 50 | NO | - | 分类名称 |
| slug | VARCHAR | 100 | NO | - | 分类别名，唯一 |
| description | VARCHAR | 200 | YES | NULL | 分类描述 |
| icon | VARCHAR | 50 | YES | NULL | 分类图标 |
| sort_order | INT | - | NO | 0 | 排序顺序 |
| status | TINYINT | - | NO | 1 | 状态：0-禁用，1-启用 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_slug (slug)
- KEY idx_status (status)
- KEY idx_sort (sort_order)

---

## 3. 标签表 (tags)

存储文章标签信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 标签ID，主键 |
| name | VARCHAR | 50 | NO | - | 标签名称，唯一 |
| slug | VARCHAR | 100 | NO | - | 标签别名，唯一 |
| description | VARCHAR | 200 | YES | NULL | 标签描述 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_name (name)
- UNIQUE KEY uk_slug (slug)

---

## 4. 文章表 (articles)

存储文章基本信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 文章ID，主键 |
| title | VARCHAR | 200 | NO | - | 文章标题 |
| slug | VARCHAR | 200 | NO | - | 文章别名，唯一 |
| summary | TEXT | - | YES | NULL | 文章摘要 |
| content | LONGTEXT | - | NO | - | 文章内容（Markdown） |
| cover | VARCHAR | 500 | YES | NULL | 封面图片URL |
| category_id | BIGINT | - | YES | NULL | 分类ID，外键 |
| author_id | BIGINT | - | NO | - | 作者ID，外键 |
| views | BIGINT | - | NO | 0 | 浏览次数 |
| likes | INT | - | NO | 0 | 点赞数 |
| favorites | INT | - | NO | 0 | 收藏数 |
| comment_count | INT | - | NO | 0 | 评论数 |
| status | TINYINT | - | NO | 1 | 状态：0-草稿，1-已发布 |
| is_top | TINYINT | - | NO | 0 | 是否置顶：0-否，1-是 |
| sort_order | INT | - | NO | 0 | 排序顺序 |
| published_at | TIMESTAMP | - | YES | NULL | 发布时间 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_slug (slug)
- KEY idx_category_id (category_id)
- KEY idx_author_id (author_id)
- KEY idx_status (status)
- KEY idx_published_at (published_at)
- KEY idx_views (views)
- KEY idx_likes (likes)
- KEY idx_created_at (created_at)
- KEY idx_is_top_status (is_top, status)

**外键:**
- FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL
- FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE

---

## 5. 文章标签关联表 (article_tags)

文章和标签的多对多关联表

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 主键ID |
| article_id | BIGINT | - | NO | - | 文章ID |
| tag_id | BIGINT | - | NO | - | 标签ID |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_article_tag (article_id, tag_id)
- KEY idx_article_id (article_id)
- KEY idx_tag_id (tag_id)

**外键:**
- FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
- FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE

---

## 6. 评论表 (comments)

存储文章评论

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 评论ID，主键 |
| article_id | BIGINT | - | NO | - | 文章ID，外键 |
| user_id | BIGINT | - | NO | - | 评论用户ID，外键 |
| parent_id | BIGINT | - | YES | NULL | 父评论ID（用于回复） |
| content | TEXT | - | NO | - | 评论内容 |
| status | TINYINT | - | NO | 1 | 状态：0-待审核，1-已通过，2-已拒绝 |
| ip_address | VARCHAR | 50 | YES | NULL | IP地址 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- PRIMARY KEY (id)
- KEY idx_article_id (article_id)
- KEY idx_user_id (user_id)
- KEY idx_parent_id (parent_id)
- KEY idx_status (status)
- KEY idx_created_at (created_at)

**外键:**
- FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
- FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
- FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE

---

## 7. 系列表 (series)

存储专栏系列信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 系列ID，主键 |
| name | VARCHAR | 100 | NO | - | 系列名称 |
| slug | VARCHAR | 100 | NO | - | 系列别名，唯一 |
| icon | VARCHAR | 50 | YES | NULL | 系列图标（emoji） |
| description | TEXT | - | YES | NULL | 系列描述 |
| cover | VARCHAR | 500 | YES | NULL | 系列封面图 |
| sort_order | INT | - | NO | 0 | 排序顺序 |
| status | TINYINT | - | NO | 1 | 状态：0-禁用，1-启用 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_slug (slug)
- KEY idx_status (status)
- KEY idx_sort (sort_order)

---

## 8. 章节标题表 (series_sections)

存储系列下的章节标题（如"基础篇"、"进阶篇"）

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 章节标题ID，主键 |
| series_id | BIGINT | - | NO | - | 所属系列ID，外键 |
| name | VARCHAR | 100 | NO | - | 章节标题名称 |
| description | TEXT | - | YES | NULL | 章节标题描述 |
| sort_order | INT | - | NO | 0 | 排序顺序 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- PRIMARY KEY (id)
- KEY idx_series_id (series_id)
- KEY idx_sort (sort_order)

**外键:**
- FOREIGN KEY (series_id) REFERENCES series(id) ON DELETE CASCADE

---

## 9. 子章节表 (series_subchapters)

存储章节标题下的子章节（目录）

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 子章节ID，主键 |
| section_id | BIGINT | - | NO | - | 所属章节标题ID，外键 |
| name | VARCHAR | 100 | NO | - | 子章节名称 |
| description | TEXT | - | YES | NULL | 子章节描述 |
| sort_order | INT | - | NO | 0 | 排序顺序 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- PRIMARY KEY (id)
- KEY idx_section_id (section_id)
- KEY idx_sort (sort_order)

**外键:**
- FOREIGN KEY (section_id) REFERENCES series_sections(id) ON DELETE CASCADE

---

## 10. 子章节文章关联表 (subchapter_articles)

子章节和文章的多对多关联表

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 主键ID |
| subchapter_id | BIGINT | - | NO | - | 子章节ID |
| article_id | BIGINT | - | NO | - | 文章ID |
| sort_order | INT | - | NO | 0 | 在子章节中的排序 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_subchapter_article (subchapter_id, article_id)
- KEY idx_subchapter_id (subchapter_id)
- KEY idx_article_id (article_id)
- KEY idx_sort (sort_order)

**外键:**
- FOREIGN KEY (subchapter_id) REFERENCES series_subchapters(id) ON DELETE CASCADE
- FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE

---

## 11. 点赞记录表 (article_likes)

存储文章点赞记录

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 主键ID |
| article_id | BIGINT | - | NO | - | 文章ID，外键 |
| user_id | BIGINT | - | NO | - | 用户ID，外键 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 点赞时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_article_user (article_id, user_id)
- KEY idx_article_id (article_id)
- KEY idx_user_id (user_id)
- KEY idx_created_at (created_at)

**外键:**
- FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
- FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

---

## 12. 收藏记录表 (article_favorites)

存储文章收藏记录

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 主键ID |
| article_id | BIGINT | - | NO | - | 文章ID，外键 |
| user_id | BIGINT | - | NO | - | 用户ID，外键 |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 收藏时间 |

**索引:**
- PRIMARY KEY (id)
- UNIQUE KEY uk_article_user (article_id, user_id)
- KEY idx_article_id (article_id)
- KEY idx_user_id (user_id)
- KEY idx_created_at (created_at)

**外键:**
- FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
- FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

---

## 13. 浏览记录表 (article_views)

存储文章浏览记录

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 主键ID |
| article_id | BIGINT | - | NO | - | 文章ID，外键 |
| ip_address | VARCHAR | 50 | YES | NULL | IP地址 |
| user_agent | VARCHAR | 500 | YES | NULL | User Agent |
| user_id | BIGINT | - | YES | NULL | 用户ID（登录用户） |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 浏览时间 |

**索引:**
- PRIMARY KEY (id)
- KEY idx_article_id (article_id)
- KEY idx_user_id (user_id)
- KEY idx_ip_address (ip_address)
- KEY idx_created_at (created_at)

**外键:**
- FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
- FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL

---

## 表关系图

```
users (用户)
  ├── articles (1:N) - 用户发表的文章
  ├── comments (1:N) - 用户发表的评论
  ├── article_likes (1:N) - 用户的点赞记录
  └── article_favorites (1:N) - 用户的收藏记录

categories (分类)
  └── articles (1:N) - 分类下的文章

tags (标签)
  └── article_tags (N:M) - 文章标签关联

articles (文章)
  ├── category (N:1) - 所属分类
  ├── author (N:1) - 作者
  ├── article_tags (1:N) - 文章标签
  ├── comments (1:N) - 文章评论
  ├── article_likes (1:N) - 文章点赞
  ├── article_favorites (1:N) - 文章收藏
  └── article_views (1:N) - 文章浏览

comments (评论)
  ├── article (N:1) - 所属文章
  ├── user (N:1) - 评论用户
  └── parent (N:1) - 父评论（回复）

series (系列)
  └── series_sections (1:N) - 系列的章节标题

series_sections (章节标题)
  └── series_subchapters (1:N) - 章节标题下的子章节

series_subchapters (子章节)
  └── subchapter_articles (1:N) - 子章节的文章关联
```

---

## 数据库设计要点

### 1. 规范化设计
- 所有表都使用 BIGINT 作为主键，支持海量数据
- 外键关系完整，保证数据一致性
- 第三范式（3NF），避免数据冗余

### 2. 性能优化
- 为常用查询字段添加索引
- 使用联合索引优化复杂查询
- 软删除使用状态字段，而非物理删除

### 3. 扩展性
- 使用 slug 字段支持 SEO 友好的 URL
- 预留 icon、cover 等扩展字段
- 支持多对多关系（文章-标签、子章节-文章）

### 4. 安全性
- 用户密码加密存储（不存储明文）
- 记录 IP 地址和 User Agent 用于安全审计
- 评论审核机制

### 5. 统计相关
- 文章浏览、点赞、收藏使用独立的统计表
- 通过关联表统计，避免频繁更新主表
- 支持用户维度的操作记录

---

## 常用查询示例

### 获取文章列表（带分类和标签）
```sql
SELECT
  a.*,
  c.name as category_name,
  u.username as author_name,
  u.avatar as author_avatar
FROM articles a
LEFT JOIN categories c ON a.category_id = c.id
LEFT JOIN users u ON a.author_id = u.id
WHERE a.status = 1
ORDER BY a.published_at DESC
LIMIT 10 OFFSET 0;
```

### 获取文章的标签
```sql
SELECT t.* FROM tags t
JOIN article_tags at ON t.id = at.tag_id
WHERE at.article_id = ?
ORDER BY t.name;
```

### 获取文章评论（包含回复）
```sql
SELECT
  c.*,
  u.username,
  u.avatar
FROM comments c
JOIN users u ON c.user_id = u.id
WHERE c.article_id = ? AND c.parent_id IS NULL
ORDER BY c.created_at DESC;
```

### 获取系列结构和文章
```sql
SELECT
  s.id as series_id,
  s.name as series_name,
  sec.id as section_id,
  sec.name as section_name,
  sub.id as subchapter_id,
  sub.name as subchapter_name,
  a.id as article_id,
  a.title as article_title
FROM series s
JOIN series_sections sec ON s.id = sec.series_id
JOIN series_subchapters sub ON sec.id = sub.section_id
JOIN subchapter_articles sa ON sub.id = sa.subchapter_id
JOIN articles a ON sa.article_id = a.id
WHERE s.id = ?
ORDER BY sec.sort_order, sub.sort_order, sa.sort_order;
```
